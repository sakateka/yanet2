syntax = "proto3";

package forwardpb;

import "common/commonpb/target.proto";

option go_package = "github.com/yanet-platform/yanet2/modules/forward/controlplane/forwardpb;forwardpb";

// ForwardService is a controlplane service for forwarding module.
service ForwardService {
	// ListConfigs returns all forward module configurations of all
	// dataplane instances.
	rpc ListConfigs(ListConfigsRequest) returns (ListConfigsResponse);

	// ShowConfig returns the current configuration for the forward module.
	rpc ShowConfig(ShowConfigRequest) returns (ShowConfigResponse);

	rpc UpdateConfig(UpdateConfigRequest) returns (UpdateConfigResponse);

	// Allows to delete forward config if it is not referenced
	// by any pipeline.
	rpc DeleteConfig(DeleteConfigRequest) returns (DeleteConfigResponse);
}

message Config {
	// TODO
}

message ListConfigsRequest {
}

// ListConfigsResponse contains existing configurations.
message ListConfigsResponse {
	repeated string configs = 1;
}

// ShowConfigResponse retrieves the runtime configuration for the forward
// module.
message ShowConfigRequest {
	commonpb.TargetModule target = 1;
}

// ShowConfigResponse contains the configuration details of the forward module.
message ShowConfigResponse {
	Config config = 1;
}

message VlanRange {
	uint32 from = 1;
	uint32 to = 2;
}

message IPNet {
	bytes ip = 1;
	uint32 prefix_len = 2;
}

enum ForwardMode {
	NONE = 0;
	IN = 1;
	OUT = 2;
}

message ForwardRule {
	string target = 1;
	ForwardMode mode = 2;
	string counter = 3;

	repeated string devices = 4;
	repeated VlanRange vlan_ranges = 5;
	repeated IPNet srcs = 6;
	repeated IPNet dsts = 7;
}

message UpdateConfigRequest {
	commonpb.TargetModule target = 1;
	repeated ForwardRule rules = 2;
}

message UpdateConfigResponse {
	string error = 1;
}

// Delete config with specified name.
message DeleteConfigRequest {
	// Specifies module name and
	// dataplane instance of forward agent to delete.
	commonpb.TargetModule target = 1;
}

message DeleteConfigResponse {
	bool deleted = 1;
}
