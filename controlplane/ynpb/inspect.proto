syntax = "proto3";

package ynpb;

option go_package = "github.com/yanet-platform/yanet2/controlplane/ynpb;ynpb";

// InspectService provides methods to inspect the YANET2 configuration.
service InspectService {
	// Inspect retrieves the current configuration state.
	rpc Inspect(InspectRequest) returns (InspectResponse) {
	}
}

// InspectRequest is sent to retrieve current configuration.
message InspectRequest {
}

// InspectResponse contains the configuration state for the served instance.
message InspectResponse {
	// InstanceInfo contains detailed information about the dataplane instance.
	InstanceInfo instance_info = 1;
}

// InstanceInfo contains information about a dataplane instance configuration.
message InstanceInfo {
	// Instance index.
	uint32 instance_idx = 1;
	// Index of NUMA node instance attached to.
	uint32 numa_idx = 2;
	// Dataplane modules available in this dataplane instance.
	repeated DPModuleInfo dp_modules = 3;
	// Control plane configurations in this dataplane instance.
	repeated CPConfigInfo cp_configs = 4;
	// Controlplane function configurations
	repeated FunctionInfo functions = 5;
	// Pipelines configured in this dataplane instance.
	repeated PipelineInfo pipelines = 6;
	// Agents running in this dataplane instance.
	repeated AgentInfo agents = 7;
	// Devices configured in this dataplane instance.
	repeated DeviceInfo devices = 8;
}

// DPModuleInfo contains information about a dataplane module.
message DPModuleInfo {
	// Name is the name of the dataplane module.
	//
	// The module name uniquely identifies the module in the dataplane.
	string name = 1;
}

// CPConfigInfo contains information about a control plane configuration.
message CPConfigInfo {
	// Type defines the packet handler for the module
	string type = 1;
	// Type:Name is the unique identifier for this configuration.
	string name = 2;
	// Generation is the generation number of the control plane module.
	uint64 generation = 3;
}

message ChainModuleInfo {
	string type = 1;
	string name = 2;
}

message FunctionChainInfo {
	string Name = 1;
	uint64 Weight = 2;
	repeated ChainModuleInfo modules = 3;
}

message FunctionInfo {
	string Name = 1;
	repeated FunctionChainInfo chains = 2;
}

// PipelineInfo contains information about a packet processing pipeline.
message PipelineInfo {
	// Name is the name of the pipeline.
	string name = 1;
	// Modules is a list of module configurations in the pipeline's
	// processing order.
	repeated string functions = 2;
}

// AgentInfo contains information about a control plane agent.
message AgentInfo {
	// Name is the identifier for this agent.
	string name = 1;
	// Instances is a list of running instances of this agent.
	repeated AgentInstanceInfo instances = 2;
}

// AgentInstanceInfo contains information about a specific agent instance.
message AgentInstanceInfo {
	// Pid is the process ID of the agent instance.
	uint32 pid = 1;
	// MemoryLimit is the maximum memory allocation allowed for this agent
	// instance.
	uint64 memory_limit = 2;
	// Allocated is the current amount of memory allocated by this agent
	// instance.
	uint64 allocated = 3;
	// Freed is the amount of memory freed by this agent instance.
	uint64 freed = 4;
	// Generation is the generation number of the agent instance.
	uint64 generation = 5;
}

// DeviceInfo contains information about a device.
message DeviceInfo {
	string type = 1;
	string name = 2;
	// Pipelines is a list of pipelines configured for this device.
	repeated DevicePipelineInfo input_pipelines = 3;
	repeated DevicePipelineInfo output_pipelines = 4;
}

// DevicePipelineInfo contains information about a pipeline in a device.
message DevicePipelineInfo {
	// Pipeline name
	string name = 1;
	// Weight is the weight of this pipeline in the device.
	uint64 weight = 2;
}
